# Aggregate FILTER clause parity tests

statement ok
CREATE TABLE csv (id1 VARCHAR, id2 VARCHAR, id3 VARCHAR, id4 INTEGER, id5 INTEGER, id6 INTEGER, v1 INTEGER, v2 INTEGER, v3 REAL)

statement ok
INSERT INTO csv VALUES
('id001','id001','id0000000001',1,10,100,1,2,1.5),
('id001','id001','id0000000002',2,20,200,2,3,2.5),
('id001','id002','id0000000003',3,30,300,3,4,3.5),
('id001','id002','id0000000004',1,10,100,4,5,4.5),
('id002','id001','id0000000005',2,20,200,5,6,5.5),
('id002','id001','id0000000006',3,30,300,6,7,6.5),
('id002','id002','id0000000007',1,10,100,7,8,7.5),
('id002','id002','id0000000008',2,20,200,8,9,8.5),
('id003','id001','id0000000009',3,30,300,9,10,9.5),
('id003','id001','id0000000010',1,10,100,10,11,10.5),
('id003','id002','id0000000011',2,20,200,1,2,11.5),
('id003','id002','id0000000012',3,30,300,2,3,12.5),
('id004','id001','id0000000013',1,10,100,3,4,1.5),
('id004','id001','id0000000014',2,20,200,4,5,2.5),
('id004','id002','id0000000015',3,30,300,5,6,3.5),
('id004','id002','id0000000016',1,10,100,6,7,4.5),
('id005','id001','id0000000017',2,20,200,7,8,5.5),
('id005','id001','id0000000018',3,30,300,8,9,6.5),
('id005','id002','id0000000019',1,10,100,9,10,7.5),
('id005','id002','id0000000020',2,20,200,10,11,8.5)

query R
SELECT SUM(v1) FILTER (WHERE id1 = 'id001') FROM csv
----
10.0

query R
SELECT COUNT(v1) FILTER (WHERE id1 = 'id001') FROM csv
----
4.0

query TR
SELECT id2, SUM(v1) FILTER (WHERE id4 = 1) FROM csv GROUP BY id2 ORDER BY id2
----
id001 14.0
id002 26.0

query RR
SELECT SUM(v1) * 1.0, SUM(v1) FILTER (WHERE id1 = 'id001') FROM csv
----
110.0 10.0
