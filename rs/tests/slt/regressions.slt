# SQL regression parity tests not covered by core SLT suites

statement ok
CREATE TABLE csv (id1 VARCHAR, id2 VARCHAR, id3 VARCHAR, id4 INTEGER, id5 INTEGER, id6 INTEGER, v1 INTEGER, v2 INTEGER, v3 REAL)

statement ok
INSERT INTO csv VALUES
('id001','id001','id0000000001',1,10,100,1,2,1.5),
('id001','id001','id0000000002',2,20,200,2,3,2.5),
('id001','id002','id0000000003',3,30,300,3,4,3.5),
('id001','id002','id0000000004',1,10,100,4,5,4.5),
('id002','id001','id0000000005',2,20,200,5,6,5.5),
('id002','id001','id0000000006',3,30,300,6,7,6.5),
('id002','id002','id0000000007',1,10,100,7,8,7.5),
('id002','id002','id0000000008',2,20,200,8,9,8.5),
('id003','id001','id0000000009',3,30,300,9,10,9.5),
('id003','id001','id0000000010',1,10,100,10,11,10.5),
('id003','id002','id0000000011',2,20,200,1,2,11.5),
('id003','id002','id0000000012',3,30,300,2,3,12.5),
('id004','id001','id0000000013',1,10,100,3,4,1.5),
('id004','id001','id0000000014',2,20,200,4,5,2.5),
('id004','id002','id0000000015',3,30,300,5,6,3.5),
('id004','id002','id0000000016',1,10,100,6,7,4.5),
('id005','id001','id0000000017',2,20,200,7,8,5.5),
('id005','id001','id0000000018',3,30,300,8,9,6.5),
('id005','id002','id0000000019',1,10,100,9,10,7.5),
('id005','id002','id0000000020',2,20,200,10,11,8.5)

query I
SELECT COUNT(*) FROM (SELECT DISTINCT(id1) FROM csv)
----
5

query T
SELECT id1 FROM csv ORDER BY id4 DESC, id1 ASC LIMIT 1
----
id001

statement ok
CREATE TABLE onecol (a INTEGER)

statement ok
INSERT INTO onecol VALUES (1)

statement error
SELECT b FROM onecol

statement ok
CREATE TABLE twocol (a INTEGER, b INTEGER)

statement ok
INSERT INTO twocol VALUES (1, 2)

query II
SELECT b, a FROM twocol
----
2 1

statement error
SELECT 'x' AS s FROM csv

statement error
SELECT 'x' AS s FROM csv UNION ALL SELECT 'x' AS s FROM csv

statement error
SELECT 'x' AS s FROM csv INTERSECT ALL SELECT 'x' AS s FROM csv

statement error
SELECT 'x' AS s FROM csv EXCEPT ALL SELECT 'x' AS s FROM csv

query T
SELECT id1 FROM csv WHERE id1 = 'id001' INTERSECT ALL SELECT id1 FROM csv WHERE id1 = 'id002'
----

query T rowsort
SELECT id1 FROM csv WHERE id1 = 'id001' EXCEPT ALL SELECT id1 FROM csv WHERE id1 = 'id002'
----
id001
id001
id001
id001

query II
SELECT SUM(v1 + 2 * 1) - SUM(v1 + 2), SUM(2 * 1) FROM csv
----
0 40

query II
SELECT SUM(v1 + 2 * 1), SUM(v1 + 2) FROM csv
----
150 150

query II
SELECT SUM(v1 - 2 * 1), SUM(v1 - 2) FROM csv
----
70 70

query RR
SELECT AVG(v1 + v2 + 1), AVG(v1 + v2) + 1 FROM csv
----
13.0 13.0

query TI
WITH w AS (SELECT id1, v1 + v2 AS total FROM csv)
SELECT id1, total FROM w WHERE total > 10 ORDER BY total DESC, id1 DESC LIMIT 5
----
id005 21
id003 21
id005 19
id003 19
id005 17

query I
WITH w AS (
  SELECT id1, ROW_NUMBER() OVER (PARTITION BY id1 ORDER BY v1 DESC) AS rn FROM csv
)
SELECT COUNT(*) FROM w WHERE rn <= 2
----
10

query I
SELECT COUNT(*) FROM (
  SELECT *, ROW_NUMBER() OVER (PARTITION BY id1 ORDER BY v1 DESC) <= 2 AS top2 FROM csv
) sub WHERE id1 = 'id001' AND top2
----
2

query I
SELECT COUNT(*) FROM (
  SELECT *, ROW_NUMBER() OVER (PARTITION BY id1 ORDER BY v1 DESC) <= 2 AS top2 FROM csv
) sub WHERE top2
----
10

query I
SELECT COUNT(*) FROM (
  SELECT *, ROW_NUMBER() OVER (PARTITION BY id1 ORDER BY v1 DESC) AS rn FROM csv
) sub WHERE id1 = 'id001' AND rn <= 2
----
2

query I
SELECT COUNT(*) FROM (
  SELECT *, ROW_NUMBER() OVER (PARTITION BY id1 ORDER BY v1 DESC) <= 2 AS top2 FROM csv
) WHERE id1 = 'id002'
----
4

statement ok
CREATE TABLE x (id1 VARCHAR, v INTEGER)

statement ok
INSERT INTO x VALUES ('id001', 1), ('id001', 2), ('id002', 3), ('id003', 4), ('id004', 5), ('id005', 6)

statement ok
CREATE TABLE y (id1 VARCHAR, x1 INTEGER)

statement ok
INSERT INTO y VALUES ('id001', 100), ('id002', 200), ('id003', 300), ('id006', 400)

query I
SELECT COUNT(*) FROM x FULL OUTER JOIN y ON x.id1 = y.id1
----
7

statement error
SELECT * FROM nonexistent
