# Type system, CAST, and expression tests for Teide SQL

# --- Setup ---

statement ok
CREATE TABLE types (i INTEGER, bi BIGINT, r REAL, s VARCHAR, b BOOLEAN)

statement ok
INSERT INTO types VALUES (1, 100, 1.5, 'hello', true), (2, 200, 2.5, 'world', false), (3, 300, 3.5, 'test', true)

# === CAST ===

# --- CAST integer to real ---

query R
SELECT CAST(i AS REAL) FROM types WHERE i = 1
----
1.0

# --- CAST shorthand :: syntax ---

query R
SELECT i::REAL FROM types WHERE i = 1
----
1.0

# === Boolean expressions ===

query I
SELECT COUNT(*) FROM types WHERE b = true
----
2

query I
SELECT COUNT(*) FROM types WHERE b = false
----
1

# === BETWEEN ===

query I rowsort
SELECT i FROM types WHERE i BETWEEN 1 AND 2
----
1
2

query I
SELECT i FROM types WHERE i NOT BETWEEN 1 AND 2
----
3

query R rowsort
SELECT r FROM types WHERE r BETWEEN 1.0 AND 2.5
----
1.5
2.5

# === IN list ===

query I rowsort
SELECT i FROM types WHERE i IN (1, 3)
----
1
3

query I
SELECT i FROM types WHERE i NOT IN (1, 3)
----
2

query T rowsort
SELECT s FROM types WHERE s IN ('hello', 'test')
----
hello
test

# === LIKE / ILIKE ===

statement ok
CREATE TABLE patterns (s VARCHAR)

statement ok
INSERT INTO patterns VALUES ('Hello'), ('hello'), ('HELLO'), ('Help'), ('world')

query T rowsort
SELECT s FROM patterns WHERE s LIKE 'Hel%'
----
Hello
Help

query T rowsort
SELECT s FROM patterns WHERE s LIKE '%llo'
----
Hello
hello

query T rowsort
SELECT s FROM patterns WHERE s ILIKE 'hel%'
----
HELLO
Hello
Help
hello

query T rowsort
SELECT s FROM patterns WHERE s NOT LIKE 'H%'
----
hello
world

# === CASE expressions ===

statement ok
CREATE TABLE case_t (i INTEGER)

statement ok
INSERT INTO case_t VALUES (1), (2), (3)

query IT
SELECT i, CASE WHEN i = 1 THEN 'one' WHEN i = 2 THEN 'two' ELSE 'other' END FROM case_t ORDER BY i
----
1 one
2 two
3 other

query IT
SELECT i, CASE i WHEN 1 THEN 'one' WHEN 2 THEN 'two' ELSE 'other' END FROM case_t ORDER BY i
----
1 one
2 two
3 other

# === Complex boolean expressions ===

query I rowsort
SELECT i FROM types WHERE (i > 1 AND r < 3.5) OR s = 'test'
----
2
3

query I
SELECT i FROM types WHERE NOT (i = 2) AND i < 3
----
1

# === Arithmetic type promotion ===

query IR
SELECT i, i + r FROM types ORDER BY i
----
1 2.5
2 4.5
3 6.5

query IR
SELECT i, i * 1.5 FROM types ORDER BY i
----
1 1.5
2 3.0
3 4.5

# === Modulo ===

statement ok
CREATE TABLE modtest (a INTEGER, b INTEGER)

statement ok
INSERT INTO modtest VALUES (10, 3), (7, 2)

query II
SELECT a, a % b FROM modtest WHERE a = 10
----
10 1

query II
SELECT a, a % b FROM modtest WHERE a = 7
----
7 1
