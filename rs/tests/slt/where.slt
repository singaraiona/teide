# WHERE clause and filtering tests for Teide SQL

# --- Setup ---

statement ok
CREATE TABLE data (id INTEGER, val REAL, name VARCHAR, cat VARCHAR)

statement ok
INSERT INTO data VALUES (1, 10.5, 'alice', 'a'), (2, 20.0, 'bob', 'b'), (3, 30.5, 'carol', 'a'), (4, 40.0, 'dave', 'b'), (5, 50.5, 'eve', 'c')

# === Basic comparisons ===

query I
SELECT COUNT(*) FROM data WHERE id = 3
----
1

query I
SELECT COUNT(*) FROM data WHERE id != 3
----
4

query I
SELECT COUNT(*) FROM data WHERE id > 3
----
2

query I
SELECT COUNT(*) FROM data WHERE id >= 3
----
3

query I
SELECT COUNT(*) FROM data WHERE id < 3
----
2

query I
SELECT COUNT(*) FROM data WHERE id <= 3
----
3

# === Float comparison ===

query I
SELECT COUNT(*) FROM data WHERE val > 25.0
----
3

query IR
SELECT id, val FROM data WHERE val = 20.0
----
2 20.0

# === String comparison ===

query IT
SELECT id, name FROM data WHERE name = 'carol'
----
3 carol

# === AND / OR / NOT ===

query I rowsort
SELECT id FROM data WHERE id > 2 AND id < 5
----
3
4

query I rowsort
SELECT id FROM data WHERE id = 1 OR id = 5
----
1
5

query I rowsort
SELECT id FROM data WHERE NOT (id > 3)
----
1
2
3

# === Complex boolean ===

query I rowsort
SELECT id FROM data WHERE (cat = 'a' AND val > 20.0) OR (cat = 'c')
----
3
5

query I rowsort
SELECT id FROM data WHERE cat = 'b' AND (id < 3 OR id > 3)
----
2
4

# === BETWEEN ===

query I rowsort
SELECT id FROM data WHERE id BETWEEN 2 AND 4
----
2
3
4

query I rowsort
SELECT id FROM data WHERE id NOT BETWEEN 2 AND 4
----
1
5

query I rowsort
SELECT id FROM data WHERE val BETWEEN 20.0 AND 40.0
----
2
3
4

# === IN list ===

query I rowsort
SELECT id FROM data WHERE id IN (1, 3, 5)
----
1
3
5

query I rowsort
SELECT id FROM data WHERE id NOT IN (1, 3, 5)
----
2
4

query T rowsort
SELECT name FROM data WHERE name IN ('alice', 'eve')
----
alice
eve

query T rowsort
SELECT name FROM data WHERE cat IN ('a', 'c')
----
alice
carol
eve

# === LIKE ===

query T rowsort
SELECT name FROM data WHERE name LIKE 'a%'
----
alice

query T rowsort
SELECT name FROM data WHERE name LIKE '%e'
----
alice
dave
eve

query T rowsort
SELECT name FROM data WHERE name LIKE '%o%'
----
bob
carol

# === ILIKE (case-insensitive) ===

statement ok
CREATE TABLE mixed_case (s VARCHAR)

statement ok
INSERT INTO mixed_case VALUES ('Apple'), ('BANANA'), ('cherry'), ('Date')

query T rowsort
SELECT s FROM mixed_case WHERE s ILIKE 'a%'
----
Apple

query T rowsort
SELECT s FROM mixed_case WHERE s ILIKE '%an%'
----
BANANA

# === WHERE with expressions ===

query I rowsort
SELECT id FROM data WHERE id + 1 > 4
----
4
5

query I rowsort
SELECT id FROM data WHERE val * 2.0 > 60.0
----
3
4
5

query I
SELECT id FROM data WHERE ABS(val - 30.5) < 1.0
----
3

# === WHERE with aggregation (HAVING) ===

query TI rowsort
SELECT cat, COUNT(*) AS cnt FROM data GROUP BY cat HAVING COUNT(*) > 1
----
a 2
b 2
